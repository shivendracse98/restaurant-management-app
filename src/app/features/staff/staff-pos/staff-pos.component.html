<div class="staff-pos-container">
  <!-- Header -->
  <div class="header-row">
    <h2>üë®‚Äçüíº Staff POS</h2>
    <div class="tab-buttons">
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'ORDER'" 
        (click)="switchTab('ORDER')"
      >
        üõí Take Order
      </button>
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'TIFFIN'" 
        (click)="switchTab('TIFFIN')"
      >
        üç± Tiffin
      </button>
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'ONGOING'" 
        (click)="switchTab('ONGOING')"
      >
        ‚è≥ Ongoing
      </button>
      <button 
        class="tab-btn" 
        [class.active]="activeTab === 'REVENUE'" 
        (click)="switchTab('REVENUE')"
      >
        üìä Revenue
      </button>
    </div>
  </div>

  <!-- Message -->
  <div *ngIf="message" class="message">{{ message }}</div>

  <!-- ========== TAKE ORDER TAB ========== -->
  <div *ngIf="activeTab === 'ORDER'" class="pos-layout">
    <!-- Left: Menu Items -->
    <div class="menu-section">
      <div class="search-bar">
        <input 
          type="text" 
          [(ngModel)]="searchTerm" 
          placeholder="üîç Search menu or category..."
          class="search-input"
        />
      </div>

      <div class="menu-grid">
        <div class="menu-item" *ngFor="let item of filteredMenu; trackBy: trackByItem">
          <img [src]="item.imageUrl" [alt]="item.name" />
          <div class="meta">
            <div class="name">{{ item.name }}</div>
            <div class="category">{{ item.category }}</div>
            <div class="price">‚Çπ{{ item.price }}</div>
          </div>
          <button class="btn add" (click)="addItem(item)">+ Add</button>
        </div>
      </div>
    </div>

    <!-- Right: Order Form & Cart (Sticky) -->
    <div class="cart-section">
      <div class="cart-wrapper">
        <h3 class="cart-title">üìã Current Order</h3>

        <!-- Order Details Form -->
        <form [formGroup]="orderForm" class="order-form">
          <div class="form-row">
            <label>Customer Name</label>
            <input type="text" formControlName="customerName" placeholder="Walk-in Guest" />
          </div>

          <div class="form-row">
            <label>Phone</label>
            <input type="tel" formControlName="customerPhone" placeholder="0000000000" />
          </div>

          <div class="form-row">
            <label>Order Type</label>
            <select formControlName="orderType">
              <option value="DINE_IN">Dine In</option>
              <option value="TAKEAWAY">Takeaway</option>
              <option value="DELIVERY">Delivery</option>
            </select>
          </div>

          <div class="form-row">
            <label>Table #</label>
            <input type="text" formControlName="tableNumber" placeholder="Optional" />
          </div>
        </form>

        <!-- Cart Items (Scrollable) -->
        <div class="cart-items">
          <h4 class="items-title">Items</h4>
          
          <div *ngIf="cartItems.length === 0" class="empty-cart">
            üëâ Add items from menu ‚Üí
          </div>

          <div *ngFor="let item of cartItems; let i = index" class="cart-item">
            <div class="item-info">
              <div class="item-name">{{ item.name }}</div>
              <div class="item-price">‚Çπ{{ item.price }}</div>
            </div>
            <button class="remove-btn" (click)="removeItemFromOrder(i)">‚úï</button>
          </div>
        </div>

        <!-- Total & Action Buttons -->
        <div class="cart-footer">
          <div class="total-section">
            <div class="total-label">Total</div>
            <div class="total-amount">‚Çπ{{ getTotal(cartItems) }}</div>
          </div>

          <button 
            class="btn place-order-btn" 
            (click)="placeOrder()"
            [disabled]="cartItems.length === 0 || isLoading"
          >
            {{ isLoading ? '‚è≥ Placing...' : '‚úì Place Order' }}
          </button>
          
          <button class="btn clear-btn" (click)="clearCart()">Clear Cart</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== TIFFIN TAB ========== -->
  <div *ngIf="activeTab === 'TIFFIN'" class="tab-content">
    <h3>üç± Tiffin Subscriptions</h3>
    
    <!-- Quick Select Plans with Images -->
    <div class="tiffin-quick">
      <div class="plan" (click)="selectTiffinPlan('plain')">
        <img src="/assets/images/plain-thali.jpg" alt="Plain Thali" class="plan-image" />
        <div class="plan-details">
          <div class="plan-name">Plain Thali</div>
          <div class="plan-original-price">‚Çπ2,100 (30 days)</div>
          <div class="plan-price">‚Çπ1,900</div>
          <div class="plan-offer">‚ú® 1 Free!</div>
        </div>
      </div>

      <div class="plan" (click)="selectTiffinPlan('deluxe')">
        <img src="/assets/images/deluxe-thali.jpg" alt="Deluxe Thali" class="plan-image" />
        <div class="plan-details">
          <div class="plan-name">Deluxe Thali</div>
          <div class="plan-original-price">‚Çπ2,700 (30 days)</div>
          <div class="plan-price">‚Çπ2,430</div>
          <div class="plan-offer">‚ú® 1 Free!</div>
        </div>
      </div>

      <div class="plan" (click)="selectTiffinPlan('special')">
        <img src="/assets/images/special-thali.jpg" alt="Special Thali" class="plan-image" />
        <div class="plan-details">
          <div class="plan-name">Special Thali</div>
          <div class="plan-original-price">‚Çπ3,600 (30 days)</div>
          <div class="plan-price">‚Çπ3,240</div>
          <div class="plan-offer">‚ú® 1 Free!</div>
        </div>
      </div>
    </div>

    <!-- Tiffin Form -->
    <form [formGroup]="tiffinForm" class="tiffin-form">
      <div class="form-row">
        <label>Customer Name</label>
        <input type="text" formControlName="customerName" />
      </div>
      <div class="form-row">
        <label>Phone</label>
        <input type="tel" formControlName="customerPhone" />
      </div>
      <div class="form-row">
        <label>Frequency</label>
        <select formControlName="frequency">
          <option value="DAILY">Daily</option>
          <option value="WEEKLY">Weekly</option>
          <option value="MONTHLY">Monthly</option>
        </select>
      </div>
      <div class="form-row">
        <label>Duration (Months)</label>
        <input type="number" formControlName="durationMonths" min="1" />
      </div>
      <button type="button" class="btn primary-btn" (click)="createTiffin()">Create Subscription</button>
    </form>

    <!-- Tiffin List -->
    <table class="orders-table" *ngIf="subscriptionsList.length > 0">
      <thead>
        <tr>
          <th>Name</th>
          <th>Phone</th>
          <th>Plan</th>
          <th>Frequency</th>
          <th>Amount/Day</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let s of subscriptionsList">
          <td>{{ s.customerName }}</td>
          <td>{{ s.customerPhone }}</td>
          <td>{{ s.menuPlan && s.menuPlan.length ? s.menuPlan[0].name : '' }}</td>
          <td>{{ s.frequency }}</td>
          <td>‚Çπ{{ s.totalPerDelivery }}</td>
        </tr>
      </tbody>
    </table>

    <p *ngIf="subscriptionsList.length === 0" class="no-data">No active subscriptions</p>
  </div>

  <!-- ========== ONGOING ORDERS TAB ========== -->
  <div *ngIf="activeTab === 'ONGOING'" class="tab-content">
    <h3>‚è≥ Ongoing Orders</h3>
    
    <table class="orders-table" *ngIf="ongoingOrders.length > 0">
      <thead>
        <tr>
          <th>ID</th>
          <th>Table/Customer</th>
          <th>Items</th>
          <th>Total</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let o of ongoingOrders">
          <td>#{{ o.id }}</td>
          <td>{{ o.tableNumber || o.customerName || 'Guest' }}</td>
          <td>{{ o.items?.length || 0 }} items</td>
          <td>‚Çπ{{ o.total }}</td>
          <td><span class="badge">{{ o.status }}</span></td>
          <td>
            <button class="btn primary-btn" (click)="openEdit(o)">Edit</button>
          </td>
        </tr>
      </tbody>
    </table>

    <p *ngIf="ongoingOrders.length === 0" class="no-data">No ongoing orders right now</p>
  </div>

  <!-- ========== REVENUE TAB ========== -->
  <div *ngIf="activeTab === 'REVENUE'" class="tab-content revenue-tab">
    <h3>üìä Today's Revenue</h3>
    
    <div class="stats-row">
      <div class="stat-box">
        <div class="stat-label">Total Orders</div>
        <div class="stat-value">{{ todayOrders.length }}</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">Total Revenue</div>
        <div class="stat-value">‚Çπ{{ getTodayRevenueTotal() }}</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">Active Subscriptions</div>
        <div class="stat-value">{{ subscriptionsCount }}</div>
      </div>
    </div>

    <div class="chart-container" *ngIf="revenueChartData && revenueChartOptions">
      <canvas baseChart [data]="revenueChartData" [options]="revenueChartOptions" type="bar"></canvas>
    </div>

    <table class="orders-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Customer</th>
          <th>Items</th>
          <th>Total</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let o of todayOrders">
          <td>#{{ o.id }}</td>
          <td>{{ o.customerName }}</td>
          <td>{{ o.items?.length || 0 }} items</td>
          <td>‚Çπ{{ o.total }}</td>
          <td><span class="badge">{{ o.status }}</span></td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- ========== EDIT ORDER MODAL ========== -->
  <div *ngIf="showEditModal && editOrder" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <h3>Edit Order #{{ editOrder.id }}</h3>
        <button class="close-btn" (click)="closeEdit()">‚úï</button>
      </div>

      <div class="modal-body">
        <!-- Add Items Grid -->
        <h4>Add Items</h4>
        <div class="menu-grid-small">
          <div class="menu-item-small" *ngFor="let item of filteredMenu">
            <img [src]="item.imageUrl" [alt]="item.name" />
            <div class="item-info-small">
              <div class="item-name-small">{{ item.name }}</div>
              <div class="item-price-small">‚Çπ{{ item.price }}</div>
              <button class="btn" (click)="addItemToEdit(item)">+ Add</button>
            </div>
          </div>
        </div>

        <!-- Edit Items -->
        <h4>Order Items</h4>
        <div class="edit-items">
          <div *ngFor="let item of editOrder.items; let i = index" class="edit-item">
            <div class="edit-item-info">
              <div class="edit-item-name">{{ item.name }}</div>
              <div class="edit-item-price">‚Çπ{{ item.price }}</div>
            </div>
            
            <div class="qty-control">
              <button class="qty-btn" (click)="decreaseQty(item)">‚àí</button>
              <span class="qty">{{ item.qty }}</span>
              <button class="qty-btn" (click)="increaseQty(item)">+</button>
            </div>
            
            <button class="remove-btn" (click)="removeItemFromEdit(i)">Remove</button>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn" (click)="closeEdit()">Cancel</button>
        <button class="btn primary-btn" (click)="saveEdit()">Save Changes</button>
      </div>
    </div>
  </div>
</div>
