<div class="menu-container" [ngClass]="'mode-' + viewMode">

  <!-- Header with Restaurant Name -->
  <div class="menu-header-compact" *ngIf="isCustomerMode()">
    <div class="restaurant-info">
      <h1>Ordering from <span class="highlight">{{ currentTenantName || 'Restaurant' }}</span></h1>
      <a routerLink="/home" class="change-location-link">Change</a>
    </div>
  </div>

  <div class="menu-header" *ngIf="isAdminMode()">
    <h2>ğŸ½ï¸ Manage Menu</h2>
    <p class="admin-subtitle">Add, edit, or delete menu items</p>
  </div>

  <!-- Dietary Filter & Search -->
  <!-- Search & Filters -->
  <div class="search-filter-container" *ngIf="isCustomerMode()">
    <!-- Search Bar -->
    <div class="search-bar">
      <span class="search-icon">ğŸ”</span>
      <input type="text" [(ngModel)]="searchQuery" (ngModelChange)="updateSearch($event)"
        placeholder="Search for dishes..." />
      <button *ngIf="searchQuery" (click)="updateSearch('')" class="clear-btn">âœ–</button>
    </div>

    <!-- Dietary Filter -->
    <div class="dietary-filter">
      <button [class.active]="filterType === 'ALL'" (click)="setFilter('ALL')">All</button>
      <button [class.active]="filterType === 'VEG'" (click)="setFilter('VEG')" class="veg-btn">Veg Only ğŸŒ¿</button>
      <button [class.active]="filterType === 'NON_VEG'" (click)="setFilter('NON_VEG')" class="non-veg-btn">Non-Veg
        ğŸ—</button>
    </div>
  </div>

  <!-- Category Navigation (Scroll Spy) -->
  <div class="category-nav" *ngIf="categories.length > 0">
    <button *ngFor="let cat of categories" (click)="scrollToCategory(cat)" [class.active]="cat === activeCategory">
      {{ cat }}
    </button>
  </div>

  <!-- GROUPED MENU VIEW -->
  <div class="menu-sections">
    <div *ngFor="let cat of categories" [id]="'cat-' + cat" class="category-section">
      <h3 class="category-title">{{ cat }} <span class="count">({{ groupedItems[cat].length }})</span></h3>

      <div class="menu-list">
        <div class="menu-item-row" *ngFor="let item of groupedItems[cat]; trackBy: trackByItemId"
          [class.out-of-stock]="item.isAvailable === false">

          <!-- 1. Image (Left) -->
          <div class="item-visual">
            <div class="image-wrapper-circle">
              <img [src]="item.imageUrl || 'assets/default-food.png'" [alt]="item.name" loading="lazy" />
              <div *ngIf="item.isAvailable === false" class="stock-overlay-circle">
                <span>Sold Out</span>
              </div>
            </div>
            <span class="veg-dot" [class.non-veg]="!item.isVeg">
              {{ item.isVeg === false ? 'ğŸ”´' : 'ğŸŸ¢' }}
            </span>
          </div>

          <!-- 2. Content (Middle) -->
          <div class="item-content" [routerLink]="isCustomerMode() ? ['/menu', item.id] : null">
            <h4 class="item-name">{{ item.name }}</h4>
            <div class="item-price">â‚¹{{ item.price }}</div>
            <p class="item-desc">{{ item.description }}</p>
          </div>

          <!-- 3. Actions (Right) -->
          <div class="item-actions">
            <!-- Customer Actions -->
            <ng-container *ngIf="isCustomerMode()">
              <button *ngIf="item.isAvailable !== false" class="btn-add-mini"
                (click)="addToCart(item); $event.stopPropagation()">
                ADD +
              </button>
              <span *ngIf="item.isAvailable === false" class="sold-out-text">Sold Out</span>
            </ng-container>

            <!-- Admin Actions -->
            <ng-container *ngIf="isAdminMode()">
              <button class="btn-icon edit" (click)="editMenuItem(item)">âœï¸</button>
              <button class="btn-icon delete" (click)="deleteMenuItem(item)">ğŸ—‘ï¸</button>
            </ng-container>
          </div>

        </div> <!-- End menu-item-row -->
      </div> <!-- End list -->
    </div> <!-- End category-section -->
  </div>

  <!-- Empty State -->
  <div *ngIf="foodItems.length === 0" class="empty-state">
    <p>{{ isAdminMode() ? 'No menu items available' : 'Menu looks empty! ğŸ›' }}</p>
  </div>
</div>