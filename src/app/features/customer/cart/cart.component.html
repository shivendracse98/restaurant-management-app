<div class="cart-wrap" *ngIf="(items$ | async) as items">
  <h2>Your Cart ({{ cart.getCount() }} items)</h2>

  <div class="cart-list" *ngIf="items.length; else emptyTpl">
    <div class="cart-row" *ngFor="let it of items; trackBy: trackById">
      <img [src]="it.menuItem.imageUrl" [alt]="it.menuItem.name" />
      <div class="meta">
        <h4>{{ it.menuItem.name }}</h4>
        <p class="small">{{ it.menuItem.description }}</p>

        <div class="qty">
          <button (click)="cart.updateQty(it.menuItem.id, it.qty - 1)">âˆ’</button>
          <input type="number" [(ngModel)]="it.qty" (change)="cart.updateQty(it.menuItem.id, it.qty)" min="1" />
          <button (click)="cart.updateQty(it.menuItem.id, it.qty + 1)">+</button>
        </div>
      </div>

      <div class="price">â‚¹{{ it.menuItem.price * it.qty }}</div>
      <button class="remove" (click)="cart.remove(it.menuItem.id)">Remove</button>
    </div>

    <div class="summary">
      <div class="row">
        <span>Subtotal</span>
        <span class="amount">â‚¹{{ subTotal }}</span>
      </div>

      <!-- Coupon Section -->
      <div class="coupon-section">
        <div class="input-group" *ngIf="!isCouponApplied">
          <input type="text" [(ngModel)]="couponCode" placeholder="Enter Coupon Code" />
          <button (click)="applyCoupon()">Apply</button>
        </div>

        <!-- Available Coupons List -->
        <div class="available-offers" *ngIf="activeOffers.length > 0 && !isCouponApplied">
          <p class="offers-title">Available Coupons:</p>
          <div class="offer-pill" *ngFor="let offer of activeOffers" (click)="applyOffer(offer.code)">
            <span class="code">{{ offer.code }}</span>
            <span class="desc">{{ offer.description }}</span>
          </div>
        </div>

        <div class="coupon-status" *ngIf="isCouponApplied">
          <span class="success">âœ… {{ couponCode }} Applied</span>
          <button class="remove-btn" (click)="removeCoupon()">âœ–</button>
        </div>

        <p class="msg" [class.error]="!isCouponApplied && couponMessage" [class.success]="isCouponApplied">
          {{ couponMessage }}
        </p>
      </div>

      <div class="row discount" *ngIf="discountAmount > 0">
        <span>Discount</span>
        <span class="amount">-â‚¹{{ discountAmount }}</span>
      </div>

      <div class="row total">
        <strong>Total</strong>
        <strong class="amount">â‚¹{{ finalTotal }}</strong>
      </div>
    </div>

    <div class="actions">
      <button class="btn clear" (click)="cart.clear()">Clear Cart</button>
      <button class="btn primary" (click)="goToCheckout()" [disabled]="cart.getCount() === 0">
        Proceed to Checkout
      </button>
    </div>
  </div>

  <ng-template #emptyTpl>
    <div class="empty-cart">
      <img src="assets/images/empty-cart.png" alt="Empty Cart" />
      <h3>Your cart is feeling lonely ðŸ›’</h3>
      <p>Add something delicious from our <a routerLink="/menu">Menu</a>!</p>
    </div>
  </ng-template>
</div>