<!-- src/app/features/customer/checkout/payment-modal/payment-modal.component.html -->

<div class="payment-modal" style="max-height: 90vh; overflow-y: auto;">
  <!-- Header -->
  <div class="modal-header">
    <h2>ğŸ’³ Payment</h2>
    <p class="amount">Amount: <strong>â‚¹{{ data.amount }}</strong></p>
  </div>

  <!-- Payment Methods Tab -->
  <div *ngIf="!paymentSubmitted" class="payment-methods">
    <div class="method-tabs">
      <button [class.active]="paymentMethod === 'QR_CODE'" (click)="paymentMethod = 'QR_CODE'" class="method-tab">
        ğŸ“² QR Code
      </button>
      <button [class.active]="paymentMethod === 'RAZORPAY'" (click)="paymentMethod = 'RAZORPAY'" class="method-tab"
        style="background: #e3f2fd; color: #1976d2; border-color: #1976d2;">
        ğŸ’³ Pay Online
      </button>
      <button [class.active]="paymentMethod === 'UPI'" (click)="paymentMethod = 'UPI'" class="method-tab">
        ğŸ“± UPI Ref
      </button>
      <button [class.active]="paymentMethod === 'CASH'" (click)="paymentMethod = 'CASH'" class="method-tab at-counter">
        ğŸª Pay at Counter
      </button>
    </div>
  </div>

  <!-- Content -->
  <div class="modal-content">

    <!-- Platform Fee Waiver Banner -->
    <div *ngIf="paymentMethod !== 'CASH' && paymentMethod !== 'RAZORPAY' && !paymentSubmitted"
      class="fee-waiver-banner">
      <mat-icon>verified_user</mat-icon>
      <span>Upload Payment Proof to <strong>WAIVE â‚¹10 Platform Fee!</strong></span>
    </div>

    <!-- QR CODE Method -->
    <div *ngIf="paymentMethod === 'QR_CODE' && !paymentSubmitted" class="payment-section qr-section">
      <h3>Scan QR Code</h3>
      <div class="qr-container">
        <img [src]="qrCodeUrl" alt="Payment QR Code" class="qr-code" loading="lazy" />
        <p class="qr-instruction">Scan this QR with any UPI app</p>
      </div>

      <!-- Proof Input -->
      <div class="proof-input-group">
        <label>Enter UTR / Transaction ID (Required):</label>
        <input type="text" [(ngModel)]="paymentProof" placeholder="e.g. 123456789012" class="form-control">
        <small class="hint">Found in your UPI app after payment.</small>
      </div>
    </div>

    <!-- UPI Method -->
    <div *ngIf="paymentMethod === 'UPI' && !paymentSubmitted" class="payment-section upi-section">
      <h3>Pay via UPI ID</h3>
      <div class="upi-manual">
        <h4>UPI ID: <span class="highlight">{{ upiId }}</span></h4>
        <button (click)="copyUpiId()" type="button" class="btn-copy">ğŸ“‹ Copy</button>
      </div>

      <!-- Proof Input -->
      <div class="proof-input-group">
        <label>Enter UTR / Transaction ID (Required):</label>
        <input type="text" [(ngModel)]="paymentProof" placeholder="e.g. 123456789012" class="form-control">
      </div>
    </div>

    <!-- RAZORPAY Method -->
    <div *ngIf="paymentMethod === 'RAZORPAY' && !paymentSubmitted" class="payment-section razorpay-section">
      <div class="counter-pay-icon" style="color: #1976d2; background: #e3f2fd;">
        <mat-icon>security</mat-icon>
      </div>
      <h3>Secure Online Payment</h3>
      <p>Pay via UPI, Cards, or Netbanking securely.</p>

      <div class="trust-badges"
        style="display: flex; gap: 10px; justify-content: center; margin-top: 10px; opacity: 0.7;">
        <span>ğŸ”’ 100% Secure</span>
        <span>âš¡ Instant Verification</span>
      </div>
    </div>

    <!-- PAY AT COUNTER Method -->
    <div *ngIf="paymentMethod === 'CASH' && !paymentSubmitted" class="payment-section cash-section">
      <div class="counter-pay-icon">
        <mat-icon>store</mat-icon>
      </div>
      <h3>Pay at Counter</h3>
      <p>Proceed to the counter and pay via Cash or Soundbox QR.</p>
      <p class="highlight-text">Your order will be placed as <strong>PENDING</strong> until staff marks it paid.</p>
    </div>

    <!-- Payment Status -->
    <div *ngIf="paymentSubmitted" class="payment-status" [ngClass]="'status-' + paymentStatus.toLowerCase()">
      <div class="status-icon">
        <span *ngIf="paymentStatus === 'PENDING'" class="spinner"></span>
        <span *ngIf="paymentStatus === 'SUCCESS'" class="success-icon">âœ“</span>
        <span *ngIf="paymentStatus === 'FAILED'" class="error-icon">âœ•</span>
      </div>

      <div class="status-text">
        <h3>{{ paymentMessage }}</h3>
        <p *ngIf="paymentStatus === 'PENDING'">Processing...</p>
        <p *ngIf="paymentStatus === 'SUCCESS'">Verification Submitted!</p>
        <p *ngIf="paymentStatus === 'FAILED'">{{ paymentMessage }}</p>
      </div>
    </div>
  </div>

  <!-- Actions -->
  <div class="modal-actions">
    <button *ngIf="!paymentSubmitted" (click)="cancelPayment()" type="button" [disabled]="processing"
      class="btn btn-secondary">
      Cancel
    </button>

    <!-- Razorpay Submit -->
    <button *ngIf="paymentMethod === 'RAZORPAY' && !paymentSubmitted" (click)="submitOnlinePayment()" type="button"
      [disabled]="processing" class="btn btn-primary" style="background: #1976d2;">
      <span *ngIf="!processing">Proceed to Pay â‚¹{{ data.amount }}</span>
      <span *ngIf="processing">â³ Processing...</span>
    </button>

    <!-- QR/UPI Submit (Requires Proof) -->
    <button *ngIf="(paymentMethod === 'QR_CODE' || paymentMethod === 'UPI') && !paymentSubmitted"
      (click)="submitProofPayment()" type="button" [disabled]="processing || !paymentProof || paymentProof.length < 4"
      class="btn btn-primary" style="background: #27AE60;"> <!-- Green for Verified -->
      <span *ngIf="!processing">âœ“ Submit Proof</span>
      <span *ngIf="processing">â³ Verifying...</span>
    </button>

    <!-- Pay at Counter Submit -->
    <button *ngIf="paymentMethod === 'CASH' && !paymentSubmitted" (click)="submitCounterPayment()" type="button"
      [disabled]="processing" class="btn btn-primary" style="background: #E67E22;"> <!-- Orange for Pending -->
      <span *ngIf="!processing">Place Order (Pay Later)</span>
      <span *ngIf="processing">â³ Processing...</span>
    </button>

    <!-- Status Actions (Retry/Done) -->
    <button *ngIf="paymentStatus === 'FAILED'" (click)="retryPayment()" type="button" class="btn btn-primary">
      Retry
    </button>

    <button *ngIf="paymentStatus === 'SUCCESS'" (click)="dialogRef.close({success: true})" type="button"
      class="btn btn-primary">
      Done
    </button>
  </div>
</div>