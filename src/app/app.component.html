<!-- ============================
     NAVIGATION BAR
============================ -->
<nav class="navbar">
  <div class="nav-left">
    <a class="logo" (click)="goHome()">
      <ng-container
        *ngIf="auth.isLoggedIn() && (auth.isAdmin() || auth.isStaff()) && auth.currentUser()?.restaurantName; else defaultLogo">
        {{ auth.currentUser()?.restaurantName }}
      </ng-container>
      <ng-template #defaultLogo>
        ğŸ´ TasteTown
      </ng-template>
    </a>
  </div>

  <div class="nav-right" *ngIf="auth.isLoggedIn()">
    <!-- Desktop Welcome Msg -->
    <span class="welcome d-none-mobile">
      ğŸ‘‹ {{ auth.currentUser()?.name || auth.currentUser()?.email }}
    </span>

    <!-- Mobile Shortcuts (Super Admin Only) -->
    <ng-container *ngIf="auth.isSuperAdmin()">
      <a routerLink="/super-admin/dashboard" class="mobile-icon-link" title="Command Center">ğŸ </a>
      <a routerLink="/super-admin/onboard" class="mobile-icon-link" title="Onboard">â•</a>
    </ng-container>

    <button class="btn logout d-none-mobile" (click)="logout()">
      <span>Logout</span>
    </button>
  </div>

  <!-- Hamburger Menu (Mobile Only) -->
  <button class="hamburger-menu" (click)="toggleMobileMenu()" [class.active]="isMobileMenuOpen">
    <span class="bar"></span>
    <span class="bar"></span>
    <span class="bar"></span>
  </button>

  <!-- Mobile Overlay -->
  <div class="mobile-overlay" *ngIf="isMobileMenuOpen" (click)="closeMobileMenu()"></div>

  <!-- Mobile Nav Links Container (Modified Structure) -->
  <div class="nav-links" [class.mobile-open]="isMobileMenuOpen" (click)="closeMobileMenu()">
    <!-- Guest Links -->
    <ng-container *ngIf="!auth.isLoggedIn(); else loggedLinks">
      <a routerLink="/home" routerLinkActive="active">Home</a>
      <a routerLink="/menu" routerLinkActive="active">Menu</a>
      <a routerLink="/cart" routerLinkActive="active" class="cart-link">
        ğŸ›’ Cart
        <span class="badge" *ngIf="cartCount > 0">{{ cartCount }}</span>
      </a>
      <a routerLink="/login" routerLinkActive="active">Login</a>
      <a routerLink="/register" routerLinkActive="active">Register</a>
    </ng-container>

    <!-- Logged-in Links -->
    <ng-template #loggedLinks>

      <!-- ğŸ‘‘ Super Admin -->
      <ng-container *ngIf="auth.isSuperAdmin()">
        <a routerLink="/super-admin/dashboard" routerLinkActive="active" style="color: #FFD700; font-weight: bold;">ğŸ‘‘
          Command Center</a>
      </ng-container>

      <!-- ğŸ›¡ï¸ Admin -->
      <ng-container *ngIf="auth.isAdmin()">
        <a routerLink="/admin/dashboard" routerLinkActive="active">Dashboard</a>
        <a routerLink="/admin/orders" routerLinkActive="active">Orders</a>
        <a routerLink="/admin/menu" routerLinkActive="active">Menu Mgmt</a>
        <a routerLink="/admin/offers" routerLinkActive="active">Offers ğŸ«</a>
        <a routerLink="/admin/payments" routerLinkActive="active">Payments</a>
        <a routerLink="/admin/staff" routerLinkActive="active">Staff</a>
        <a routerLink="/staff/pos" routerLinkActive="active">POS</a>
      </ng-container>

      <!-- ğŸ§‘â€ğŸ³ Staff (Pure Staff) -->
      <ng-container *ngIf="auth.isStaff() && !auth.isAdmin()">
        <a [routerLink]="['/staff/pos']" [queryParams]="{ tab: 'order' }" routerLinkActive="active">
          POS
        </a>
        <a routerLink="/staff/today-orders" routerLinkActive="active">
          Today's Orders
        </a>
      </ng-container>

      <!-- ğŸ‘¤ Customer (If not Admin, Staff, or Super Admin) -->
      <ng-container *ngIf="!auth.isAdmin() && !auth.isStaff() && !auth.isSuperAdmin()">

        <!-- ğŸ“ Location Picker -->
        <div class="location-picker" *ngIf="currentTenantName">
          <span class="loc-icon">ğŸ“</span>
          <span class="loc-name">{{ currentTenantName }}</span>
          <a routerLink="/home" class="loc-change">Change</a>
        </div>

        <a routerLink="/customer/dashboard" routerLinkActive="active">Dashboard</a>
        <a routerLink="/menu" routerLinkActive="active">Menu</a>
        <a routerLink="/cart" routerLinkActive="active" class="cart-link">
          ğŸ›’ Cart
          <span class="badge" *ngIf="cartCount > 0">{{ cartCount }}</span>
        </a>
        <a routerLink="/orders" routerLinkActive="active">My Orders</a>
      </ng-container>

    </ng-template>

    <!-- Mobile-Only Logout -->
    <a *ngIf="auth.isLoggedIn()" (click)="logout()" class="mobile-logout" style="color: #c62828;">
      Logout
    </a>
  </div>
</nav>

<!-- ============================
     MAIN CONTENT
============================ -->
<main>
  <router-outlet></router-outlet>
</main>

<!-- ============================
     TOAST NOTIFICATION
============================ -->
<div class="toast" *ngIf="toastVisible">{{ toastMessage }}</div>

<!-- ============================
     MOBILE BOTTOM NAV
============================ -->
<!-- Show only for Customers/Guests on Mobile -->
<app-mobile-bottom-nav *ngIf="!auth.isAdmin() && !auth.isStaff() && !auth.isSuperAdmin()"></app-mobile-bottom-nav>